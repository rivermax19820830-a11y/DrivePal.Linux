@* 捕获所有相关路由，并将最后一部分作为参数 *@
@page "/"
@page "/crane-industry"
@page "/crane-industry/{SubPage}"
@using DrivePal.Core.Enums
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime

<PageTitle>变频器选型计算器</PageTitle>
<style>
	/* 默认隐藏所有tab-pane */
	.tab-content > .tab-pane {
		display: none;
	}
		/* 只显示有 active 类的那个 */
		.tab-content > .tab-pane.active {
			display: block;
		}

	/* 移除 tab 内容区域的默认边距和边框 */
	.tab-container .card {
		border: none;
		padding: 0;
	}


	/* --- 全新的背景滑块Tab样式 --- */
	.sliding-tabs {
		position: relative;
		background-color: #f1f1f1; /* 容器的浅灰色背景 */
		border-radius: 99px; /* 圆角 */
		padding: 5px;
		display: flex; /* 使用flex布局 */
	}

		.sliding-tabs .nav-item {
			flex: 1; /* 让每个nav-item平分宽度 */
			text-align: center;
			z-index: 2; /* 置于滑块之上 */
		}

		.sliding-tabs .nav-link {
			color: #333; /* 未激活状态的文字颜色 */
			background: none !important; /* 强制背景透明 */
			border: none;
			font-weight: 500;
			transition: color 0.3s ease-in-out;
			width: 100%;
		}

			.sliding-tabs .nav-link.active {
				color: #fff; /* 激活状态的文字颜色 */
			}

	/* 滑块的样式 */
	.nav-slider {
		position: absolute;
		top: 5px;
		bottom: 5px;
		background-color: #0d6efd; /* 滑块的蓝色背景 */
		border-radius: 99px;
		box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		z-index: 1; /* 置于文字之下 */
		/* 核心动画效果 */
		transition: left 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), width 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
	}
</style>


<div class="text-center mb-4" style="display:none">
	<h2 class="fw-bold">变频器选型计算器</h2>
	<p class="text-muted">专业的变频器容量选择工具，支持多种行业场景和两种计算方法</p>
</div>

<div class="row" style="display:none">
	<div class="col-12 col-sm-6">
		<select class="form-control form-control-lg" @onchange="HandleIndustryChange">
			<option value="1">起重行业</option>
			<option value="2">盾构行业</option>
			<option value="3">港口行业</option>
			<option value="4">纺织行业</option>
			<option value="5">船舶行业</option>
		</select>
	</div>
</div>


<div class="container mt-4" style="max-width: 960px;">

	<div class="nav nav-pills sliding-tabs mb-3" id="crane-calc-tabs"> 
		<div class="nav-slider"></div> 
			<li class="nav-item">
				<NavLink class="nav-link" href="crane-industry/hoist" Match="NavLinkMatch.All">
					起升机构
				</NavLink>
			</li>
			<li class="nav-item">
				<NavLink class="nav-link" href="crane-industry/trolley">
					大小车机构
				</NavLink>
			</li>
			<li class="nav-item">
				<NavLink class="nav-link" href="crane-industry/luffer">
					变幅机构
				</NavLink>
			</li>
			<li class="nav-item">
				<NavLink class="nav-link" href="crane-industry/rotate">
					旋转机构
				</NavLink>
			</li>
			<li class="nav-item">
				<NavLink class="nav-link" href="crane-industry/afe">
					多传动系统AFE
				</NavLink>
			</li> 
	</div>
	<div class="border-top-0 "> 
		<div class="tab-content ">
			<div class="tab-pane @GetTabClass("hoist")">
				<HoistingMechanismCalc />
			</div>
			<div class="tab-pane @GetTabClass("trolley")">
				<TrolleyGantryMechanismCalc />
			</div>
			<div class="tab-pane @GetTabClass("luffer")">
				<LuffingMechanismCalc />
			</div>
			<div class="tab-pane @GetTabClass("rotate")">
				<RotatingMechanismCalc />
			</div>
			<div class="tab-pane @GetTabClass("afe")">
				<AFECalc />
			</div>
		</div>
	</div>
</div>

@code {
	[Parameter]
	public string? SubPage { get; set; }

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		await JSRuntime.InvokeVoidAsync("updateSlider", "crane-calc-tabs");
	}

	protected override void OnParametersSet()
	{
		// 如果 SubPage 参数为空 (意味着用户访问的是 / 或 /crane-industry)
		if (string.IsNullOrEmpty(SubPage))
		{
			// 则导航到默认的tab页，并替换历史记录
			Navigation.NavigateTo("crane-industry/hoist", replace: true);
		}
	}


	private string GetTabClass(string tabName)
	{
		return (SubPage?.ToLower() ?? "hoist") == tabName ? "active" : "";
	}

	public string StrategyName { get; set; } = "general";
	public int SelectedIndustryTypeValue { get; set; } = 0;
	public IndustryTypes SelectedIndustryType { get; set; } = IndustryTypes.CraneIndustry;
	private void HandleIndustryChange(ChangeEventArgs e)
	{
		if (e.Value != null && int.TryParse(e.Value.ToString(), out int value))
		{

			SelectedIndustryTypeValue = value;
			SelectedIndustryType = (IndustryTypes)value;

			// 根据选择的行业值跳转到对应的页面
			switch (SelectedIndustryType)
			{
				case IndustryTypes.CraneIndustry:

					//Navigation.NavigateTo("/crane-industry"); // 工业起重页面
					StrategyName = "crane";
					break;
				case IndustryTypes.ShieldTunnelingIndustry:
					//Navigation.NavigateTo("/shield-industry"); // 盾构行业页面
					break;
				case IndustryTypes.PortEquipment:
					//Navigation.NavigateTo("/port-industry"); // 港口行业页面
					break;
				case IndustryTypes.TextileManufacturingIndustry:
					//Navigation.NavigateTo("/textile-industry"); // 纺织行业页面
					break;
				case IndustryTypes.ShipbuildingIndustry:
					//Navigation.NavigateTo("/ship-industry"); // 船舶行业页面
					break;
				default:
					StrategyName = "general";
					break;
			}
		} 
	}
}